@using PhoneStore_MVC.Models;
@{
    ViewBag.Title = "ChiTietSanPham";
    Layout = "~/Views/Shared/_LayoutHome.cshtml";
}
@{
    var dt = ViewBag.SPCungNSX;
}
<!-- Begin Body Wrapper -->
<div class="body-wrapper">
    <!-- Begin Header Area -->
    <!--<header>-->
    <!-- Begin Mobile Menu Area -->
    <!--<div class="mobile-menu-area d-lg-none d-xl-none col-12">
        <div class="container">
            <div class="row">
                <div class="mobile-menu">
                </div>
            </div>
        </div>
    </div>-->
    <!-- Mobile Menu Area End Here -->
    <!--</header>-->
    <!-- Header Area End Here -->
    <!-- Begin Li's Breadcrumb Area -->
    <div class="breadcrumb-area">
        <div class="container">
            <div class="breadcrumb-content">
                <ul>
                    <li><a href="@Url.Action("TrangChu","Home")">Home</a></li>
                    <li class="active">Single Product</li>
                </ul>
            </div>
        </div>
    </div>
    <!-- Li's Breadcrumb Area End Here -->
    <!-- content-wraper start -->
    <div class="content-wraper">
        <div class="container">
            <div class="row single-product-area">
                <div class="col-lg-5 col-md-6">
                    <!-- Product Details Left -->
                    <div class="product-details-left">
                        <div class="product-details-images slider-navigation-1">

                        </div>
                        <div class="product-details-thumbs slider-thumbs-1" id="product_img_total">

                        </div>
                    </div>
                    <!--// Product Details Left -->
                </div>

                <div class="col-lg-7 col-md-6">
                    <div class="product-details-view-content pt-60">
                        <div class="product-info">
                            <span class="product-details-ref">Code: </span><h2 style="display:inline" id="product_code"></h2><br /><br />
                            <span class="product-details-ref">Name: </span><h2 style="display:inline" id="product_name"></h2><br /><br />
                            <span class="product-details-ref">Brand: </span><span class="product-details-ref" id="product_brand"></span>
                            <span style="display:none" id="product_first_img"></span>
                            <div class="rating-box pt-20">
                                <ul class="rating rating-with-review-item">
                                    <li><i class="far fa-star" aria-hidden="true"></i></li>
                                    <li><i class="far fa-star" aria-hidden="true"></i></li>
                                    <li><i class="far fa-star" aria-hidden="true"></i></li>
                                    <li class="no-star"><i class="far fa-star" aria-hidden="true"></i></li>
                                    <li class="no-star"><i class="far fa-star" aria-hidden="true"></i></li>
                                    <li class="review-item"><a href="#">Read Review</a></li>
                                    <li class="review-item"><a href="#">Write Review</a></li>
                                </ul>
                            </div>
                            <div class="price-box pt-20">
                                <span class="new-price new-price-2 product_price">Price: </span><span class="new-price new-price-2 product_price" id="product_price"></span>
                            </div>
                            <span class="product-details-ref">Product Instock: </span><span class="product-details-ref" id="product_quantity"></span>
                            @*<div class="product-desc">
                                    <p>
                                        <span>
                                            100% cotton double printed dress. Black and white striped top and orange high waisted skater skirt bottom. Lorem ipsum dolor sit amet, consectetur adipisicing elit. quibusdam corporis, earum facilis et nostrum dolorum accusamus similique eveniet quia pariatur.
                                        </span>
                                    </p>
                                </div>*@
                            <div class="product-variants">
                                <div class="produt-variants-size">
                                    <label>Product Color</label>
                                    <select class="form-control" style="width:200px" id="product_color">
                                    </select>
                                </div>
                            </div>
                            <div class="single-add-to-cart">
                                <form action="#" class="cart-quantity">
                                    <div class="quantity">
                                        <label>Quantity</label>
                                        <div class="cart-plus-minus">
                                            <input class="cart-plus-minus-box" value="1" type="text">
                                            <div class="dec qtybutton"><i class="fa fa-angle-down"></i></div>
                                            <div class="inc qtybutton"><i class="fa fa-angle-up"></i></div>
                                        </div>
                                    </div>
                                    <button class="add-to-cart" id="btn_add_cart">Add to cart</button>
                                </form>
                            </div>
                            <div class="product-additional-info pt-25">
                                <a class="wishlist-btn" href="wishlist.html"><i class="fa fa-heart-o"></i>Add to wishlist</a>
                                <div class="product-social-sharing pt-25">
                                    <ul>
                                        <li class="facebook"><a href="#"><i class="fab fa-facebook"></i>Facebook</a></li>
                                        <li class="twitter"><a href="#"><i class="fab fa-twitter"></i>Twitter</a></li>
                                        <li class="google-plus"><a href="#"><i class="fab fa-google-plus"></i>Google +</a></li>
                                        <li class="instagram"><a href="#"><i class="fab fa-instagram"></i>Instagram</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="block-reassurance">
                                <ul>
                                    <li>
                                        <div class="reassurance-item">
                                            <div class="reassurance-icon">
                                                <i class="fas fa-check-square"></i>
                                            </div>
                                            <p>Security policy (edit with Customer reassurance module)</p>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="reassurance-item">
                                            <div class="reassurance-icon">
                                                <i class="fa fa-truck"></i>
                                            </div>
                                            <p>Delivery policy (edit with Customer reassurance module)</p>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="reassurance-item">
                                            <div class="reassurance-icon">
                                                <i class="fa fa-exchange"></i>
                                            </div>
                                            <p> Return policy (edit with Customer reassurance module)</p>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- content-wraper end -->
    <!-- Begin Product Area -->
    <div class="product-area pt-35">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="li-product-tab">
                        <ul class="nav li-product-menu">
                            <li><a class="active" data-toggle="tab" href="#product-details"><span>Product Details</span></a></li>
                            <li><a data-toggle="tab" href="#reviews"><span>Reviews</span></a></li>
                        </ul>
                    </div>
                    <!-- Begin Li's Tab Menu Content Area -->
                </div>
            </div>
            <div class="tab-content">
                @*<div id="description" class="tab-pane active show" role="tabpanel">
                        <div class="product-description">
                            <span>The best is yet to come! Give your walls a voice with a framed poster. This aesthethic, optimistic poster will look great in your desk or in an open-space office. Painted wooden frame with passe-partout for more depth.</span>
                        </div>
                    </div>*@
                <div id="product-details" class="tab-pane active show" role="tabpanel">
                    <div class="product-details-manufacturer">
                        @*<a href="#">
                                <img src="" alt="Product Manufacturer Image">
                            </a>
                            <p><span>Reference</span> demo_7</p>
                            <p><span>Reference</span> demo_7</p>*@
                        <div class="product-desc">
                            <p>
                                <table class="table" width="100%" id="product_details">
                                    <tbody>
                                    </tbody>
                                </table>
                            </p>
                        </div>
                    </div>
                </div>
                <div id="reviews" class="tab-pane" role="tabpanel">
                    <div class="product-reviews">
                        <div class="product-details-comment-block">
                            <div class="comment-review">
                                <span>Grade</span>
                                <ul class="rating">
                                    <li><i class="fa fa-star-o"></i></li>
                                    <li><i class="fa fa-star-o"></i></li>
                                    <li><i class="fa fa-star-o"></i></li>
                                    <li class="no-star"><i class="fa fa-star-o"></i></li>
                                    <li class="no-star"><i class="fa fa-star-o"></i></li>
                                </ul>
                            </div>
                            <div class="comment-author-infos pt-25">
                                <span>HTML 5</span>
                                <em>01-12-18</em>
                            </div>
                            <div class="comment-details">
                                <h4 class="title-block">Demo</h4>
                                <p>Plaza</p>
                            </div>
                            <div class="review-btn">
                                <a class="review-links" href="#" data-toggle="modal" data-target="#mymodal">Write Your Review!</a>
                            </div>
                            <!-- Begin Quick View | Modal Area -->
                            <div class="modal fade modal-wrapper" id="mymodal">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                    <div class="modal-content">
                                        <div class="modal-body">
                                            <h3 class="review-page-title">Write Your Review</h3>
                                            <div class="modal-inner-area row">
                                                <div class="col-lg-6">
                                                    <div class="li-review-product">
                                                        <img src="" alt="Li's Product">
                                                        <div class="li-review-product-desc">
                                                            <p class="li-product-name">Today is a good day Framed poster</p>
                                                            <p>
                                                                <span>Beach Camera Exclusive Bundle - Includes Two Samsung Radiant 360 R3 Wi-Fi Bluetooth Speakers. Fill The Entire Room With Exquisite Sound via Ring Radiator Technology. Stream And Control R3 Speakers Wirelessly With Your Smartphone. Sophisticated, Modern Design </span>
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <div class="li-review-content">
                                                        <!-- Begin Feedback Area -->
                                                        <div class="feedback-area">
                                                            <div class="feedback">
                                                                <h3 class="feedback-title">Our Feedback</h3>
                                                                <form action="#">
                                                                    <p class="your-opinion">
                                                                        <label>Your Rating</label>
                                                                        <span>
                                                                            @*<select class="star-rating">
                                                                                    <option value="1">1</option>
                                                                                    <option value="2">2</option>
                                                                                    <option value="3">3</option>
                                                                                    <option value="4">4</option>
                                                                                    <option value="5">5</option>
                                                                                </select>*@
                                                                            <input type="text" id="txtDanhGia"/>
                                                                        </span>
                                                                    </p>
                                                                    <p class="feedback-form">
                                                                        <label for="feedback">Your Review</label>
                                                                        <textarea id="feedback" name="comment" cols="45" rows="8" aria-required="true"></textarea>
                                                                    </p>
                                                                    <div class="feedback-input">
                                                                        <p class="feedback-form-author">
                                                                            <label for="author">
                                                                                Name<span class="required">*</span>
                                                                            </label>
                                                                            <input id="author" name="author" value="" size="30" aria-required="true" type="text">
                                                                        </p>
                                                                        <p class="feedback-form-author feedback-form-email">
                                                                            <label for="email">
                                                                                Email<span class="required">*</span>
                                                                            </label>
                                                                            <input id="email" name="email" value="" size="30" aria-required="true" type="text">
                                                                            <span class="required"><sub>*</sub> Required fields</span>
                                                                        </p>
                                                                        <div class="feedback-btn pb-15">
                                                                            <a href="#" class="close" data-dismiss="modal" aria-label="Close">Close</a>
                                                                            <a href="#" id="btn_submit_review">Submit</a>
                                                                        </div>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                        <!-- Feedback Area End Here -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Quick View | Modal Area End Here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Product Area End Here -->
    <!-- Begin Li's Laptop Product Area -->
    <section class="product-area li-laptop-product pt-30 pb-50">
        <div class="container">
            <div class="row">
                <!-- Begin Li's Section Area -->
                <div class="col-lg-12">
                    <div class="li-section-title">
                        <h2>
                            <span>@ViewBag.SoLuong other products in the same category:</span>
                        </h2>
                    </div>
                    <div class="row">
                        <div class="product-active owl-carousel" id="sp_cungnsx">
                            @foreach (var item in dt)
                            {
                                <div class="col-lg-12">
                                    @*single-product-wrap start*@
                                    <div class="single-product-wrap">
                                        <div class="product-image">
                                            <a href="@Url.Action("ChiTietSanPham","Home",new { id = item.MaDT})">
                                                <img src="@Url.Content("~/PhoneImages/" + item.Anh[0])" alt="">
                                            </a>
                                            <span class="sticker">New</span>
                                        </div>
                                        <div class="product_desc">
                                            <div class="product_desc_info">
                                                <div class="product-review">
                                                    <h5 class="manufacturer">
                                                        <a href="product-details.html">@item.MaNSX</a>
                                                    </h5>
                                                    <div class="rating-box">
                                                        <ul class="rating">
                                                            <li><i class="fa fa-star-o"></i></li>
                                                            <li><i class="fa fa-star-o"></i></li>
                                                            <li><i class="fa fa-star-o"></i></li>
                                                            <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                            <li class="no-star"><i class="fa fa-star-o"></i></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <h4><a class="product_name" href="single-product.html">@item.TenDT</a></h4>
                                                <div class="price-box">
                                                    <span class="new-price">@item.Gia[0]</span>
                                                </div>
                                            </div>
                                            @*<div class="add-actions">
                                                    <ul class="add-actions-link">
                                                        <li class="add-cart active"><a href="#">Add to cart</a></li>
                                                        <li><a href="#" title="quick view" class="quick-view-btn" data-toggle="modal" data-target="#exampleModalCenter"><i class="fa fa-eye"></i></a></li>
                                                        <li><a class="links-details" href="wishlist.html"><i class="fa fa-heart-o"></i></a></li>
                                                    </ul>
                                                </div>*@
                                        </div>
                                    </div>
                                    @*single-product-wrap end*@
                                </div>
                            }

                        </div>
                    </div>
                </div>
                <!-- Li's Section Area End Here -->
            </div>
        </div>
    </section>
    <!-- Li's Laptop Product Area End Here -->
    <!-- Begin Quick View | Modal Area -->
    <div class="modal fade modal-wrapper" id="exampleModalCenter">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <div class="modal-inner-area row">
                        <div class="col-lg-5 col-md-6 col-sm-6">
                            <!-- Product Details Left -->
                            <div class="product-details-left">
                                <div class="product-details-images slider-navigation-1">
                                    <div class="lg-image">
                                        <img src="" alt="product image">
                                    </div>

                                </div>
                                <div class="product-details-thumbs slider-thumbs-1">
                                    <div class="sm-image"><img src="" alt="product image thumb"></div>
                                </div>
                            </div>
                            <!--// Product Details Left -->
                        </div>

                        <div class="col-lg-7 col-md-6 col-sm-6">
                            <div class="product-details-view-content pt-60">
                                <div class="product-info">
                                    <h2>Today is a good day Framed poster</h2>
                                    <span class="product-details-ref">Reference: demo_15</span>
                                    <div class="rating-box pt-20">
                                        <ul class="rating rating-with-review-item">
                                            <li><i class="fa fa-star-o"></i></li>
                                            <li><i class="fa fa-star-o"></i></li>
                                            <li><i class="fa fa-star-o"></i></li>
                                            <li class="no-star"><i class="fa fa-star-o"></i></li>
                                            <li class="no-star"><i class="fa fa-star-o"></i></li>
                                            <li class="review-item"><a href="#">Read Review</a></li>
                                            <li class="review-item"><a href="#">Write Review</a></li>
                                        </ul>
                                    </div>
                                    <div class="price-box pt-20">
                                        <span class="new-price new-price-2">$57.98</span>
                                    </div>
                                    <div class="product-desc">
                                        <p>
                                            <span>
                                                100% cotton double printed dress. Black and white striped top and orange high waisted skater skirt bottom. Lorem ipsum dolor sit amet, consectetur adipisicing elit. quibusdam corporis, earum facilis et nostrum dolorum accusamus similique eveniet quia pariatur.
                                            </span>
                                        </p>
                                    </div>
                                    <div class="product-variants">
                                        <div class="produt-variants-size">
                                            <label>Dimension</label>
                                            <select class="nice-select">
                                                <option value="1" title="S" selected="selected">40x60cm</option>
                                                <option value="2" title="M">60x90cm</option>
                                                <option value="3" title="L">80x120cm</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="single-add-to-cart">
                                        <form action="#" class="cart-quantity">
                                            <div class="quantity">
                                                <label>Quantity</label>
                                                <div class="cart-plus-minus">
                                                    <input class="cart-plus-minus-box" value="1" type="text">
                                                    <div class="dec qtybutton"><i class="fa fa-angle-down"></i></div>
                                                    <div class="inc qtybutton"><i class="fa fa-angle-up"></i></div>
                                                </div>
                                            </div>
                                            <button class="add-to-cart">Add to cart</button>
                                        </form>
                                    </div>
                                    <div class="product-additional-info pt-25">
                                        <a class="wishlist-btn" href="wishlist.html"><i class="fa fa-heart-o"></i>Add to wishlist</a>
                                        <div class="product-social-sharing pt-25">
                                            <ul>
                                                <li class="facebook"><a href="#"><i class="fa fa-facebook"></i>Facebook</a></li>
                                                <li class="twitter"><a href="#"><i class="fa fa-twitter"></i>Twitter</a></li>
                                                <li class="google-plus"><a href="#"><i class="fa fa-google-plus"></i>Google +</a></li>
                                                <li class="instagram"><a href="#"><i class="fa fa-instagram"></i>Instagram</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Quick View | Modal Area End Here -->
</div>
<!-- Body Wrapper End Here -->
<!-- single-product31:32-->

@section scripts{
    <script type="text/javascript">
        function LoadDuLieu() {
            var id = '@ViewBag.MaDT';
            $.getJSON('/api/SanPhamAPI/ChiTietSanPham?id=' + id, function (data) {
                console.log(data);
                $('#product_code').html(data.MaDT);
                $('#product_name').html(data.TenDT);
                $('#product_brand').html(data.MaNSX);
                $('#product_price').html(data.Gia[0]);
                $('#product_first_img').text(data.Anh[0]);
                $('#product_quantity').text(data.SoLuong[0]);
                var lg_img = '';
                var sm_img = '';
                var color = '';
                for (var i = 0; i < data.Anh.length; i++) {
                    lg_img += '<div class="lg-image">'+
                        '<a class="popup-img venobox vbox-item" id = "product_img_thumb" href = "#" data - gall="myGallery" >'+
                        '<img src = "/PhoneImages/' + data.Anh[i] + '" alt = "product image" >'+
                        '</a>'+
                        '</div >';
                    sm_img += '<div class="sm-image"><img src="/PhoneImages/' + data.Anh[i] + '" alt="product image"></div>';
                }
                $('.slider-navigation-1').slick('removeSlide', null, null, true);
                $('.slider-thumbs-1').slick('removeSlide', null, null, true);
                $('.product-details-images').html(lg_img);
                $('.slider-navigation-1')[0].slick.refresh();
                $('.product-details-thumbs').html(sm_img);
                $('.slider-thumbs-1')[0].slick.refresh();

                //Màu sản phẩm
                $('#product_color').html('');
                for (var i = 0; i < data.Mau.length; i++) {
                    //console.log('Màu '+i+data.Mau[i]);
                    color += '<option value ="' + data.Mau[i] + '">' + data.Mau[i] + '</option>';
                }
                $('#product_color').html(color);

                //Đổi giá tiền theo màu
                $('#product_color').on('change', function () {
                    //alert(this.value);
                    $.getJSON('/api/SanPhamAPI/GetProductPrice?id=' + id + '&color=' + this.value, function (data) {
                        //alert(data);
                        $('#product_price').html(data[0].DonGiaBan);
                        $('#product_quantity').html(data[0].SoLuong);
                    });
                });
                //Thông số sản phẩm
                var thongso = '<tr>' +
                    '<td style = "background-color:lightgray; width:200px" >Chip</td >' +
                    '<td>' + data.Chip + '</td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td style="background-color:lightgray">Ram</td>' +
                    '<td>' + data.Ram + '</td>' +
                    '</tr>' +
                    '<tr>' +
                    '<td style="background-color:lightgray">Memory</td>' +
                    '<td>' + data.BoNhoTrong + '</td>' +
                    '</tr>' +
                    '<tr> ' +
                    '<td style = "background-color:lightgray" > Battery</td > ' +
                    '<td>' + data.Pin + '</td > ' +
                    '</tr>' +
                    '<tr> ' +
                    '<td style = "background-color:lightgray" > OS</td > ' +
                    '<td>' + data.HeDieuHanh + '</td > ' +
                    '</tr>' +
                    '<tr>' +
                    '<td style = "background-color:lightgray" > Size</td > ' +
                    '<td>' + data.KichThuoc + '</td > ' +
                    '</tr>';
                $('#product_details tbody').html(thongso);
            });
        }
        LoadDuLieu();


        $('#btn_submit_review').click(function () {
            var id = '@ViewBag.MaDT';
            var danhgia = $('#txtDanhGia').val();
            //alert($('#txtDanhGia').val() + id);
            $.ajax({
                type: 'PUT',
                url: '/api/DanhGia?masp=' + id + "&a=" + danhgia,
                contentType: 'application/json',
                success: function (result) {
                    console.log(result);
                },
            }).done(function () {
                console.log('Edit done');
            }).fail(function (msg) {
                console.log('Edit FAIL');
            });

        });





        //Lấy thông tin giỏ hàng
        var Cart = [];
        if (sessionStorage.getItem('giohang') === null) {
            //dulieu = sessionStorage.getItem('giohang');
        } else {
            Cart = JSON.parse(sessionStorage.getItem('giohang'));
        }

        $('#btn_add_cart').click(function (e) {
            e.preventDefault();
            var sp = 0;
            if (sessionStorage.getItem("sosp") !== null) {
                sp = parseInt(sessionStorage.getItem("sosp"));
            }
            var soluong = $(this).parent().children().children().children("input[type=text]").val();
            var soluongconlai = $('#product_quantity').text();
            if (Number(soluong) > Number(soluongconlai)) {
                alert('Not enough products instock');
                return;
            }
            var tensp = $(' #product_name').text();
            var masp = $('#product_code').text();
            var mau = $('#product_color').val();
            var gia = $('#product_price').text();
            var anh = $('#product_first_img').text();

            console.log("ten:" + tensp + " ma: " + masp + " mau: " + mau + " gia: " + gia + " soluong: " + soluong + " anh: " + anh);
            var i = 0;
            for (; i < Cart.length; i++) {
                if (Cart[i].MaSP == masp && Cart[i].Mau == mau) {
                    Cart[i].Quantity += parseInt(soluong);
                    sp += parseInt(soluong);
                    sessionStorage.setItem("sosp", sp);
                    UpdateCartCount();
                    break;
                }
            }
            // Neu i == cart.length -> vong for tren chua duoc break hoac khong thay phan tu nao thoa man dieu kien
            if (Cart && (Cart.length == 0 || i == Cart.length)) {
                Cart.push({ MaSP: masp, TenSP: tensp, Anh: anh, Gia: gia, Mau: mau, Quantity: parseInt(soluong) });
                sp += parseInt(soluong);
                sessionStorage.setItem("sosp", sp);
                UpdateCartCount();
            }
            console.log('Cart:' + JSON.stringify(Cart));
            if (sessionStorage) {
                sessionStorage.setItem('giohang', JSON.stringify(Cart));
                DisplayMiniCart(true);
            }
            alert("Added to cart");
            return false;
        })



    </script>


}
